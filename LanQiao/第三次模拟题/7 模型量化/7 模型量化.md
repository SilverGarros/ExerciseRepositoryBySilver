## 实现模型量化

#### 介绍

在深度学习模型的部署过程中，模型的大小和运行效率是非常重要的因素。TensorFlow Lite 是一个用于移动和嵌入式设备的开源深度学习框架，它可以将模型大小减小，并提高运行效率。现在，你们已经完成了虚假新闻模型训练，接下来你们小组将继续完成模型的量化。

#### 准备

开始答题前，请确认 `/home/project` 目录下包含以下文件：

- model.h5

- word_index.json

- task.py

  其中：

- `model.h5` 是本任务提供的基于 Tensorflow.keras 训练的可用于虚假新闻识别的二分类模型。

- `word_index.json` 是在模型训练之前基于训练集生成的词汇表。在本任务中，你可以使用它将测试数据转换为 id 序列。关于词汇表的生成，可参考如下代码片段。

  ```python
  from tensorflow.keras.preprocessing.text import Tokenizer
  tokenizer = Tokenizer()
  # 生成词汇表，texts 是训练集（若干行分词后的句子）
  tokenizer.fit_on_texts(texts) 
  # 获取词汇表
  word_index = tokenizer.word_index
  # 保存词汇表
  with open('word_index.json', 'w', encoding='utf-8') as f:
      json.dump(word_index, f, ensure_ascii=False)
  ```

- `task.py`，是你后续答题过程中编写代码的地方。

#### 目标

请在 `task.py` 文件中按要求实现以下目标函数。

**`quantize_model` 函数**

- 功能
  - 使用 TensorFlow Lite 的 TFLiteConverter 进行量化。
  - 将训练好的 Keras 模型的所有参数量化为 16 位浮点数。
  - 将量化后的模型保存为 TFLite 格式，模型大小不超过 4MB。
- 参数
  - model_path (str): 已经训练好的模型的文件路径。
  - quantized_model_path (str): 量化后的模型的保存路径。
- 返回值：无

**`prediction_label` 函数**

- 功能

  - 使用量化模型对给定的句子进行预测，并返回预测的类别标签。

    > 提示：模型预测前需将句子处理成长度 100 的序列。

- 参数

  - test_sentence (str): 需要进行预测的句子。
  - model_path (str): 量化后的模型的文件路径。

- 返回值

  - prediction_label (int): 预测的类别标签，值为 0 或 1。

基于以下代码补充 `#TODO` 处的函数代码，确保使用量化后的模型可以实现正常推理预测。

> 提示：点击代码块右上方的 copy 按钮，将代码完整复制到右侧环境中后开始编码。

```python
#quantize-start
import tensorflow as tf
import os
import numpy as np
from tensorflow.keras.preprocessing.text import Tokenizer
from tensorflow.keras.preprocessing.sequence import pad_sequences
import json

def quantize_model(model_path, quantized_model_path):
    #TODO

    


def prediction_label(test_sentence, model_path):
    # TODO





def main():
    # 量化模型
    quantize_model('/home/project/model.h5', '/home/project/quantized_model.tflite')
    # 测试示例
    test_sentence = "一个 公益广告 ： 爸爸 得 了 老年痴呆  儿子 带 他 去 吃饭  盘子 里面 剩下 两个 饺子  爸爸 直接 用手 抓起 饺子 放进 了 口袋  儿子 愣住 了  爸爸 说  我 儿子 最爱 吃 这个 了  最后 广告 出字 ： 他 忘记 了 一切  但 从未 忘记 爱 你    「 转 」"
    print(prediction_label(test_sentence, '/home/project/quantized_model.tflite'))

if __name__ == "__main__":  
    main()
#quantize-end
```

#### 规定

- 切勿删除以上代码块中的任何字符，以免造成判题不通过。
- 切勿修改任务中默认提供的文件名称、函数名称等，以免造成判题不通过。

#### 判分标准

- 实现目标函数，该题得 15 分。
- 未实现目标函数，该题得 0 分。